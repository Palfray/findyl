<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sleeve Notes â€” findyl</title>
  <meta name="description" content="Vinyl guides, new release roundups, album features and more from findyl.">
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-4VKXNETWR4"></script>
  <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','G-4VKXNETWR4');</script>
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=Raleway:wght@400;500&display=swap" rel="stylesheet">
  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * { font-family: 'DM Serif Display', serif; font-weight: 400; color: #374151; }
    h1, h2, h3, h4, h5, h6 { font-family: 'DM Serif Display', serif; font-weight: 700; color: #111827; letter-spacing: -0.01em; }

    /* Card grid */
    .articles-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 24px;
    }
    @media (max-width: 900px) {
      .articles-grid { grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 560px) {
      .articles-grid { grid-template-columns: 1fr; }
    }

    /* Card styles */
    .article-card {
      transition: transform 0.2s, box-shadow 0.2s;
      overflow: hidden;
      border-radius: 12px;
      background: #fff;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
      text-decoration: none;
      display: flex;
      flex-direction: column;
    }
    .article-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(0,0,0,0.12);
    }
    .article-card .card-img {
      width: 100%;
      height: 200px;
      object-fit: cover;
      display: block;
    }
    .article-card .card-body {
      padding: 20px;
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    .article-card .card-title {
      font-size: 1.05rem;
      line-height: 1.3;
      margin-bottom: 8px;
      color: #111827;
    }
    .article-card .card-desc {
      color: #6B7280;
      font-size: 0.88rem;
      line-height: 1.5;
      margin: 0;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    /* Pill styles */
    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: flex-start;
      overflow: hidden;
      transition: max-height 0.25s ease, opacity 0.25s ease, margin 0.25s ease;
    }
    .pill-row.collapsed {
      max-height: 0;
      opacity: 0;
      margin-top: 0 !important;
      margin-bottom: 0 !important;
    }
    .pill-row.expanded {
      max-height: 200px;
      opacity: 1;
    }

    /* Level 1 â€” Category pills */
    .cat-pill {
      padding: 6px 18px;
      border-radius: 9999px;
      font-size: 0.85rem;
      font-weight: 500;
      cursor: pointer;
      border: 1.5px solid #D1D5DB;
      background: #fff;
      color: #6B7280;
      transition: all 0.15s ease;
    }
    .cat-pill:hover { border-color: #FF6B6B; color: #FF6B6B; }
    .cat-pill.active { background: #FF6B6B; color: #fff; border-color: #FF6B6B; }

    /* Level 2 â€” Series sub-pills */
    .series-pill {
      padding: 5px 14px;
      border-radius: 9999px;
      font-size: 0.8rem;
      font-weight: 500;
      cursor: pointer;
      border: 1.5px solid #D1D5DB;
      background: #fff;
      color: #6B7280;
      transition: all 0.15s ease;
    }
    .series-pill:hover { border-color: #FF6B6B; color: #FF6B6B; }
    .series-pill.active { background: #FFF0F0; color: #FF6B6B; border-color: #FF6B6B; }

    /* Level 3 â€” Genre pills */
    .genre-pill {
      padding: 4px 12px;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 500;
      cursor: pointer;
      border: 1.5px solid #D1D5DB;
      background: #fff;
      color: #6B7280;
      transition: all 0.15s ease;
    }
    .genre-pill:hover { border-color: #FFB5B5; color: #FF6B6B; }
    .genre-pill.active { background: #FFF5F5; color: #FF6B6B; border-color: #FFB5B5; }

    /* Tag badges */
    .meta-tag {
      display: inline-block;
      font-size: 0.7rem;
      font-weight: 500;
      padding: 2px 8px;
      border-radius: 9999px;
      letter-spacing: 0.03em;
      text-transform: capitalize;
    }
  </style>
</head>
<body class="bg-gray-50">

  <!-- HEADER -->
  <header id="site-header" style="position:sticky;top:0;z-index:20;background:#fff;border-bottom:1px solid #E5E7EB;">
    <div style="max-width:1100px;margin:0 auto;padding:12px 20px;display:flex;align-items:center;gap:16px;">
      <a href="/" style="flex-shrink:0;text-decoration:none;">
        <svg width="128" height="40" viewBox="0 0 320 100" fill="none">
          <text x="0" y="72" font-family="'DM Serif Display', serif" font-size="80" fill="#1F2937" font-weight="400">findyl</text>
          <g transform="translate(245, 50)">
            <circle cx="0" cy="0" r="28" fill="#FF6B6B"/>
            <circle cx="0" cy="0" r="22" fill="none" stroke="white" stroke-width="1"/>
            <circle cx="0" cy="0" r="16" fill="none" stroke="white" stroke-width="1"/>
            <circle cx="0" cy="0" r="10" fill="none" stroke="white" stroke-width="1"/>
            <circle cx="0" cy="0" r="8" fill="white"/>
            <circle cx="0" cy="0" r="3" fill="#FF6B6B"/>
          </g>
        </svg>
      </a>
      <form id="header-search-form" action="/results" method="GET" style="flex:1;max-width:480px;position:relative;">
        <input type="text" name="q" id="header-search-input" placeholder="Search for vinyl..."
          style="width:100%;padding:10px 44px 10px 16px;border:1.5px solid #111827;border-radius:9999px;font-family:'Raleway',sans-serif;font-size:0.95rem;font-weight:400;outline:none;background:#fff;"
        >
        <button type="submit" style="position:absolute;right:12px;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;padding:0;">
          <svg width="20" height="20" fill="none" stroke="#FF6B6B" stroke-width="2.5" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        </button>
        <div id="header-autocomplete" style="display:none;position:absolute;top:100%;left:0;right:0;background:#fff;border:1px solid #E5E7EB;border-radius:12px;margin-top:4px;box-shadow:0 8px 24px rgba(0,0,0,0.12);z-index:50;max-height:400px;overflow-y:auto;"></div>
      </form>
    </div>
  </header>

  <!-- PAGE CONTENT -->
  <main style="max-width:1100px;margin:0 auto;padding:48px 20px 80px;">
    <h1 style="font-size:2.5rem;margin-bottom:8px;">Sleeve Notes</h1>
    <p style="color:#6B7280;font-size:1.05rem;margin-bottom:32px;">The records worth owning and the stories behind them.</p>

    <!-- Level 1: Category pills -->
    <div id="cat-pills" class="pill-row expanded" style="margin-bottom:12px;"></div>

    <!-- Level 2: Series sub-pills (Features only) -->
    <div id="series-pills" class="pill-row collapsed" style="margin-bottom:12px;"></div>

    <!-- Level 3: Genre pills (Genre Spotlight only) -->
    <div id="genre-pills" class="pill-row collapsed" style="margin-bottom:12px;"></div>

    <!-- Articles grid -->
    <div id="articles-grid" class="articles-grid" style="margin-top:32px;"></div>

    <div id="articles-empty" style="display:none;text-align:center;padding:60px 0;color:#9CA3AF;">
      <p style="font-size:1.1rem;">No articles yet. Check back soon.</p>
    </div>
  </main>

  <!-- FOOTER -->
  <footer style="background:#1F2937;color:#9CA3AF;padding:40px 20px;text-align:center;font-size:0.85rem;">
    <p>Â© 2026 findyl. Helping you find vinyl records from UK retailers.</p>
    <p style="margin-top:8px;">
      <a href="/about" style="color:#9CA3AF;text-decoration:underline;margin:0 8px;">About</a>
      <a href="/articles" style="color:#9CA3AF;text-decoration:underline;margin:0 8px;">Sleeve Notes</a>
      <a href="/local-stores" style="color:#9CA3AF;text-decoration:underline;margin:0 8px;">Find a store</a>
    </p>
    <p style="margin-top:8px;">
      <a href="/privacy" style="color:#9CA3AF;text-decoration:underline;margin:0 8px;">Privacy</a>
      <a href="/terms" style="color:#9CA3AF;text-decoration:underline;margin:0 8px;">Terms</a>
      <a href="/disclosure" style="color:#9CA3AF;text-decoration:underline;margin:0 8px;">Affiliate Disclosure</a>
    </p>
  </footer>

  <script>
  (function() {
    /* â”€â”€â”€ Data & state â”€â”€â”€ */
    var allArticles = [];
    var activeCat = 'all';
    var activeSeries = 'all';
    var activeGenre = 'all';

    var seriesNames = {
      'genre-spotlight': 'Genre Spotlight',
      'behind-the-sample': 'Behind the Sample',
      'history-of': 'The History of\u2026'
    };

    function cap(s) { return s ? s.charAt(0).toUpperCase() + s.slice(1) : ''; }

    function fmtDate(d) {
      var dt = new Date(d + 'T00:00:00');
      return dt.toLocaleDateString('en-GB', { day: 'numeric', month: 'long', year: 'numeric' });
    }

    /* â”€â”€â”€ Tag HTML for cards â”€â”€â”€ */
    function buildTagHtml(a) {
      var parts = [];
      if (a.category) {
        parts.push('<span class="meta-tag" style="background:#FFE5E5;color:#FF6B6B;">' + cap(a.category) + '</span>');
      }
      if (a.series && seriesNames[a.series]) {
        parts.push('<span class="meta-tag" style="background:#FFF0F0;color:#FF8A8A;">' + seriesNames[a.series] + '</span>');
      }
      if (a.genre) {
        parts.push('<span class="meta-tag" style="background:#FFF5F5;color:#FFB5B5;">' + cap(a.genre) + '</span>');
      }
      return parts.join(' ');
    }

    /* â”€â”€â”€ Render card â”€â”€â”€ */
    function cardHtml(a) {
      var imgSrc = a.heroImage ? a.heroImage.replace('front-1200', 'front-500') : '';
      var imgHtml = imgSrc
        ? '<img class="card-img" src="' + imgSrc + '" alt="' + (a.heroAlt || a.title) + '" loading="lazy" decoding="async">'
        : '<div class="card-img" style="background:#FFE5E5;display:flex;align-items:center;justify-content:center;"><span style="font-size:2.5rem;">ðŸŽµ</span></div>';

      return '<a href="/articles/' + a.slug + '" class="article-card">'
        + imgHtml
        + '<div class="card-body">'
        + '<div style="margin-bottom:8px;">' + buildTagHtml(a)
        + '<span style="color:#9CA3AF;font-size:0.75rem;margin-left:8px;">' + fmtDate(a.date) + '</span>'
        + '</div>'
        + '<h3 class="card-title">' + a.title + '</h3>'
        + '<p class="card-desc">' + a.description + '</p>'
        + '</div></a>';
    }

    /* â”€â”€â”€ Filter articles â”€â”€â”€ */
    function getFiltered() {
      var list = allArticles;
      if (activeCat !== 'all') {
        list = list.filter(function(a) { return a.category === activeCat; });
      }
      if (activeCat === 'features' && activeSeries !== 'all') {
        list = list.filter(function(a) { return a.series === activeSeries; });
      }
      if (activeSeries === 'genre-spotlight' && activeGenre !== 'all') {
        list = list.filter(function(a) { return a.genre === activeGenre; });
      }
      return list;
    }

    /* â”€â”€â”€ Render articles â”€â”€â”€ */
    function renderArticles() {
      var grid = document.getElementById('articles-grid');
      var empty = document.getElementById('articles-empty');
      var filtered = getFiltered();

      if (!filtered.length) {
        grid.innerHTML = '';
        empty.style.display = 'block';
        return;
      }
      empty.style.display = 'none';

      var html = '';
      for (var i = 0; i < filtered.length; i++) {
        html += cardHtml(filtered[i]);
      }
      grid.innerHTML = html;
    }

    /* â”€â”€â”€ Build category pills â”€â”€â”€ */
    function buildCatPills() {
      var cats = ['all', 'charts', 'features', 'guides'];
      var labels = { all: 'All', charts: 'Charts', features: 'Features', guides: 'Guides' };
      var row = document.getElementById('cat-pills');
      row.innerHTML = cats.map(function(c) {
        return '<button class="cat-pill' + (c === activeCat ? ' active' : '') + '" data-cat="' + c + '">' + labels[c] + '</button>';
      }).join('');

      row.querySelectorAll('.cat-pill').forEach(function(btn) {
        btn.addEventListener('click', function() {
          activeCat = btn.dataset.cat;
          activeSeries = 'all';
          activeGenre = 'all';
          updateAllPills();
          renderArticles();
        });
      });
    }

    /* â”€â”€â”€ Build series sub-pills â”€â”€â”€ */
    function buildSeriesPills() {
      var row = document.getElementById('series-pills');

      if (activeCat !== 'features') {
        row.classList.remove('expanded');
        row.classList.add('collapsed');
        return;
      }

      var series = ['all', 'genre-spotlight', 'behind-the-sample', 'history-of'];
      var labels = {
        all: 'All Features',
        'genre-spotlight': 'Genre Spotlight',
        'behind-the-sample': 'Behind the Sample',
        'history-of': 'The History of\u2026'
      };

      // Only show pills for series that have content
      var available = series.filter(function(s) {
        if (s === 'all') return true;
        return allArticles.some(function(a) { return a.category === 'features' && a.series === s; });
      });

      row.innerHTML = available.map(function(s) {
        return '<button class="series-pill' + (s === activeSeries ? ' active' : '') + '" data-series="' + s + '">' + labels[s] + '</button>';
      }).join('');

      row.classList.remove('collapsed');
      row.classList.add('expanded');

      row.querySelectorAll('.series-pill').forEach(function(btn) {
        btn.addEventListener('click', function() {
          activeSeries = btn.dataset.series;
          activeGenre = 'all';
          updateAllPills();
          renderArticles();
        });
      });
    }

    /* â”€â”€â”€ Build genre pills â”€â”€â”€ */
    function buildGenrePills() {
      var row = document.getElementById('genre-pills');

      if (activeSeries !== 'genre-spotlight') {
        row.classList.remove('expanded');
        row.classList.add('collapsed');
        return;
      }

      // Collect unique genres from published genre-spotlight articles
      var genres = [];
      allArticles.forEach(function(a) {
        if (a.series === 'genre-spotlight' && a.genre && genres.indexOf(a.genre) === -1) {
          genres.push(a.genre);
        }
      });
      genres.sort();

      if (genres.length < 2) {
        // Only one genre â€” no point showing genre pills
        row.classList.remove('expanded');
        row.classList.add('collapsed');
        return;
      }

      var pills = ['<button class="genre-pill' + (activeGenre === 'all' ? ' active' : '') + '" data-genre="all">All Genres</button>'];
      genres.forEach(function(g) {
        pills.push('<button class="genre-pill' + (g === activeGenre ? ' active' : '') + '" data-genre="' + g + '">' + cap(g) + '</button>');
      });

      row.innerHTML = pills.join('');
      row.classList.remove('collapsed');
      row.classList.add('expanded');

      row.querySelectorAll('.genre-pill').forEach(function(btn) {
        btn.addEventListener('click', function() {
          activeGenre = btn.dataset.genre;
          updateAllPills();
          renderArticles();
        });
      });
    }

    /* â”€â”€â”€ Refresh all pill rows â”€â”€â”€ */
    function updateAllPills() {
      buildCatPills();
      buildSeriesPills();
      buildGenrePills();
    }

    /* â”€â”€â”€ Init â”€â”€â”€ */
    fetch('/articles-index.json')
      .then(function(r) { return r.json(); })
      .then(function(articles) {
        if (!articles.length) {
          document.getElementById('articles-empty').style.display = 'block';
          return;
        }
        // Sort by date descending
        articles.sort(function(a, b) { return new Date(b.date) - new Date(a.date); });
        allArticles = articles;
        updateAllPills();
        renderArticles();
      })
      .catch(function(err) {
        console.error('Failed to load articles index:', err);
        document.getElementById('articles-empty').style.display = 'block';
      });
  })();

  /* â”€â”€â”€ Header autocomplete (self-contained IIFE) â”€â”€â”€ */
  (function() {
    var input = document.getElementById('header-search-input');
    var dropdown = document.getElementById('header-autocomplete');
    var form = document.getElementById('header-search-form');
    var debounceTimer;

    if (!input || !dropdown || !form) return;

    form.addEventListener('submit', function(e) {
      e.preventDefault();
      var q = input.value.trim();
      if (q) window.location.href = '/results?q=' + encodeURIComponent(q);
    });

    input.addEventListener('input', function() {
      clearTimeout(debounceTimer);
      var q = input.value.trim();
      if (q.length < 2) { dropdown.style.display = 'none'; return; }
      debounceTimer = setTimeout(function() {
        fetch('/api/autocomplete?q=' + encodeURIComponent(q))
          .then(function(r) { return r.json(); })
          .then(function(data) {
            if (!data.artists?.length && !data.albums?.length) { dropdown.style.display = 'none'; return; }
            var html = '';
            if (data.artists?.length) {
              html += '<div style="padding:8px 16px;font-size:0.7rem;color:#9CA3AF;text-transform:uppercase;letter-spacing:0.05em;">Artists</div>';
              data.artists.forEach(function(a) {
                var meta = [a.type, a.country, a.disambiguation].filter(Boolean).join(' Â· ');
                html += '<a href="/results?q=' + encodeURIComponent(a.name) + '" style="display:block;padding:10px 16px;text-decoration:none;color:#1F2937;font-size:0.95rem;border-bottom:1px solid #F3F4F6;">' + a.name + (meta ? '<span style="color:#9CA3AF;font-size:0.8rem;margin-left:8px;">' + meta + '</span>' : '') + '</a>';
              });
            }
            if (data.albums?.length) {
              html += '<div style="padding:8px 16px;font-size:0.7rem;color:#9CA3AF;text-transform:uppercase;letter-spacing:0.05em;">Albums</div>';
              data.albums.forEach(function(a) {
                html += '<a href="/album?artist=' + encodeURIComponent(a.artist || '') + '&album=' + encodeURIComponent(a.name) + '" style="display:block;padding:10px 16px;text-decoration:none;color:#1F2937;font-size:0.95rem;border-bottom:1px solid #F3F4F6;">' + a.name + (a.artist ? '<span style="color:#9CA3AF;font-size:0.8rem;margin-left:8px;">' + a.artist + '</span>' : '') + '</a>';
              });
            }
            dropdown.innerHTML = html;
            dropdown.style.display = 'block';
          })
          .catch(function() { dropdown.style.display = 'none'; });
      }, 300);
    });

    document.addEventListener('click', function(e) {
      if (!dropdown.contains(e.target) && e.target !== input) dropdown.style.display = 'none';
    });
  })();
  </script>

</body>
</html>
