<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sleeve Notes â€” findyl</title>
  <meta name="description" content="The records worth owning and the stories behind them. Charts, features and guides for UK vinyl collectors.">
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-4VKXNETWR4"></script>
  <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','G-4VKXNETWR4');</script>
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=Raleway:wght@400;500&display=swap" rel="stylesheet">
  <link rel="preconnect" href="https://coverartarchive.org">
  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * { font-family: 'DM Serif Display', serif; font-weight: 400; color: #374151; }
    h1, h2, h3, h4, h5, h6 { font-family: 'DM Serif Display', serif; font-weight: 700; color: #111827; letter-spacing: -0.01em; }

    /* â”€â”€ Category Pills â”€â”€ */
    .sn-pills { display: flex; justify-content: center; gap: 8px; padding: 0 24px 32px; flex-wrap: wrap; }
    .sn-pill {
      font-size: 0.85rem; font-weight: 400; padding: 8px 20px; border-radius: 9999px;
      border: 1.5px solid #D1D5DB; background: #fff; color: #6B7280;
      cursor: pointer; transition: all 0.2s; user-select: none;
    }
    .sn-pill:hover { border-color: #FF6B6B; color: #FF6B6B; }
    .sn-pill.active { background: #FF6B6B; border-color: #FF6B6B; color: #fff; }

    /* â”€â”€ Sub-pills â”€â”€ */
    .sn-sub-pills {
      display: none; justify-content: center; gap: 6px; padding: 0 24px 28px;
      flex-wrap: wrap; animation: snSlideDown 0.25s ease;
    }
    .sn-sub-pills.visible { display: flex; }
    @keyframes snSlideDown {
      from { opacity: 0; transform: translateY(-8px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .sn-sub-pill {
      font-size: 0.78rem; font-weight: 400; padding: 6px 14px; border-radius: 9999px;
      border: 1px solid #E5E7EB; background: #fff; color: #9CA3AF;
      cursor: pointer; transition: all 0.2s; user-select: none;
    }
    .sn-sub-pill:hover { border-color: #FF6B6B; color: #FF6B6B; }
    .sn-sub-pill.active { background: #FFF0F0; border-color: #FF6B6B; color: #FF6B6B; }

    /* â”€â”€ Genre pills â”€â”€ */
    .sn-genre-pills {
      display: none; justify-content: center; gap: 6px; padding: 0 24px 28px;
      flex-wrap: wrap; animation: snSlideDown 0.25s ease;
    }
    .sn-genre-pills.visible { display: flex; }
    .sn-genre-pill {
      font-size: 0.72rem; font-weight: 400; padding: 5px 12px; border-radius: 9999px;
      border: 1px solid #E5E7EB; background: #fff; color: #9CA3AF;
      cursor: pointer; transition: all 0.2s; user-select: none;
    }
    .sn-genre-pill:hover { border-color: #FF6B6B; color: #FF6B6B; }
    .sn-genre-pill.active { background: #FFF5F5; border-color: #FFB5B5; color: #FF6B6B; }

    /* â”€â”€ Article Cards â”€â”€ */
    .sn-card {
      display: flex; background: #fff; border-radius: 12px; overflow: hidden;
      box-shadow: 0 1px 3px rgba(0,0,0,0.06), 0 1px 2px rgba(0,0,0,0.04);
      transition: transform 0.2s, box-shadow 0.2s;
      text-decoration: none; color: inherit; min-height: 164px;
    }
    .sn-card:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
    .sn-card-img { width: 200px; min-width: 200px; background: #E5E7EB; overflow: hidden; }
    .sn-card-img img { width: 100%; height: 100%; object-fit: cover; display: block; }
    .sn-card-img .sn-placeholder {
      width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;
      font-size: 2rem; background: linear-gradient(135deg, #FFE5E5 0%, #FFF0F0 100%);
    }
    .sn-card-body { flex: 1; padding: 20px 24px; display: flex; flex-direction: column; justify-content: center; gap: 8px; }
    .sn-card-meta { display: flex; align-items: center; gap: 10px; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; flex-wrap: wrap; }
    .sn-meta-cat { color: #FF6B6B; }
    .sn-meta-series { color: #FF8A8A; }
    .sn-meta-genre { color: #FFB5B5; }
    .sn-meta-date { color: #9CA3AF; }
    .sn-meta-dot { width: 3px; height: 3px; border-radius: 50%; background: #D1D5DB; flex-shrink: 0; }
    .sn-card-title { font-size: 1.25rem; font-weight: 700; color: #111827; line-height: 1.35; letter-spacing: -0.01em; }
    .sn-card-desc { font-size: 0.875rem; color: #374151; line-height: 1.55; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }

    /* â”€â”€ Featured Card â”€â”€ */
    .sn-card.featured { flex-direction: column; min-height: auto; }
    .sn-card.featured .sn-card-img { width: 100%; min-width: unset; height: 320px; }
    .sn-card.featured .sn-card-body { padding: 24px 28px 28px; gap: 10px; }
    .sn-card.featured .sn-card-title { font-size: 1.6rem; }

    /* â”€â”€ Mobile â”€â”€ */
    @media (max-width: 640px) {
      .sn-pills { padding: 0 20px 24px; gap: 6px; }
      .sn-pill { padding: 7px 16px; font-size: 0.8rem; }
      .sn-sub-pills { padding: 0 16px 20px; gap: 5px; }
      .sn-sub-pill { padding: 5px 12px; font-size: 0.73rem; }
      .sn-genre-pills { padding: 0 16px 20px; gap: 5px; }
      .sn-genre-pill { padding: 4px 10px; font-size: 0.68rem; }

      .sn-card { flex-direction: column; min-height: auto; }
      .sn-card-img { width: 100%; min-width: unset; height: 180px; }
      .sn-card-body { padding: 16px 18px 20px; }
      .sn-card-title { font-size: 1.1rem; }

      .sn-card.featured .sn-card-img { height: 220px; }
      .sn-card.featured .sn-card-title { font-size: 1.25rem; }
      .sn-card.featured .sn-card-body { padding: 18px 20px 22px; }
    }
  </style>
</head>
<body class="bg-gray-50">

  <!-- HEADER -->
  <header id="site-header" style="position:sticky;top:0;z-index:20;background:#fff;border-bottom:1px solid #E5E7EB;">
    <div style="max-width:1100px;margin:0 auto;padding:12px 20px;display:flex;align-items:center;gap:16px;">
      <a href="/" style="flex-shrink:0;text-decoration:none;">
        <svg width="128" height="40" viewBox="0 0 320 100" fill="none">
          <text x="0" y="72" font-family="'DM Serif Display', serif" font-size="80" fill="#1F2937" font-weight="400">findyl</text>
          <g transform="translate(245, 50)">
            <circle cx="0" cy="0" r="28" fill="#FF6B6B"/>
            <circle cx="0" cy="0" r="22" fill="none" stroke="white" stroke-width="1"/>
            <circle cx="0" cy="0" r="16" fill="none" stroke="white" stroke-width="1"/>
            <circle cx="0" cy="0" r="10" fill="none" stroke="white" stroke-width="1"/>
            <circle cx="0" cy="0" r="8" fill="white"/>
            <circle cx="0" cy="0" r="3" fill="#FF6B6B"/>
          </g>
        </svg>
      </a>
      <form id="header-search-form" action="/results" method="GET" style="flex:1;max-width:480px;position:relative;">
        <input type="text" name="q" id="header-search-input" placeholder="Search for vinyl..."
          style="width:100%;padding:10px 44px 10px 16px;border:1.5px solid #111827;border-radius:9999px;font-family:'Raleway',sans-serif;font-size:0.95rem;font-weight:400;outline:none;background:#fff;"
        >
        <button type="submit" style="position:absolute;right:12px;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;padding:0;">
          <svg width="20" height="20" fill="none" stroke="#FF6B6B" stroke-width="2.5" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        </button>
        <div id="header-autocomplete" style="display:none;position:absolute;top:100%;left:0;right:0;background:#fff;border:1px solid #E5E7EB;border-radius:12px;margin-top:4px;box-shadow:0 8px 24px rgba(0,0,0,0.12);z-index:50;max-height:400px;overflow-y:auto;"></div>
      </form>
    </div>
  </header>

  <!-- PAGE HERO -->
  <div style="padding:48px 24px 32px;max-width:900px;margin:0 auto;text-align:center;">
    <h1 style="font-size:3.5rem;margin-bottom:10px;">Sleeve Notes</h1>
    <p style="font-size:1rem;color:#6B7280;max-width:520px;margin:0 auto;line-height:1.6;">The records worth owning and the stories behind them.</p>
  </div>

  <!-- CATEGORY PILLS -->
  <div class="sn-pills" id="sn-pills">
    <button class="sn-pill active" data-filter="all">All</button>
    <button class="sn-pill" data-filter="charts">Charts</button>
    <button class="sn-pill" data-filter="features">Features</button>
    <button class="sn-pill" data-filter="guides">Guides</button>
  </div>

  <!-- SUB-PILLS (Features series) -->
  <div class="sn-sub-pills" id="sn-sub-pills">
    <button class="sn-sub-pill active" data-series="all">All Features</button>
    <button class="sn-sub-pill" data-series="genre-spotlight">Genre Spotlight</button>
    <button class="sn-sub-pill" data-series="behind-the-sample">Behind the Sample</button>
    <button class="sn-sub-pill" data-series="history-of">The History ofâ€¦</button>
  </div>

  <!-- GENRE PILLS (dynamic) -->
  <div class="sn-genre-pills" id="sn-genre-pills">
    <button class="sn-genre-pill active" data-genre="all">All Genres</button>
  </div>

  <!-- ARTICLE GRID -->
  <div style="max-width:900px;margin:0 auto;padding:0 24px 64px;display:flex;flex-direction:column;gap:20px;" id="sn-grid">
    <div id="sn-empty" style="text-align:center;padding:48px 24px;">
      <p style="color:#9CA3AF;font-size:0.95rem;">Loading articles...</p>
    </div>
  </div>

  <!-- FOOTER -->
  <footer style="background:#1F2937;color:#9CA3AF;padding:40px 20px;text-align:center;font-size:0.85rem;">
    <p>Â© 2026 findyl. Helping you find vinyl records from UK retailers.</p>
    <p style="margin-top:8px;">
      <a href="/about" style="color:#9CA3AF;text-decoration:underline;margin:0 8px;">About</a>
      <a href="/articles" style="color:#9CA3AF;text-decoration:underline;margin:0 8px;">Sleeve Notes</a>
      <a href="/local-stores" style="color:#9CA3AF;text-decoration:underline;margin:0 8px;">Find a store</a>
    </p>
    <p style="margin-top:8px;">
      <a href="/privacy" style="color:#9CA3AF;text-decoration:underline;margin:0 8px;">Privacy</a>
      <a href="/terms" style="color:#9CA3AF;text-decoration:underline;margin:0 8px;">Terms</a>
      <a href="/disclosure" style="color:#9CA3AF;text-decoration:underline;margin:0 8px;">Affiliate Disclosure</a>
    </p>
  </footer>

  <script>
  // â”€â”€ Articles rendering + filtering â”€â”€
  (function() {
    const grid = document.getElementById('sn-grid');
    const emptyEl = document.getElementById('sn-empty');
    const pillsWrap = document.getElementById('sn-pills');
    const subPillsWrap = document.getElementById('sn-sub-pills');
    const genrePillsWrap = document.getElementById('sn-genre-pills');

    let articles = [];
    let cardEls = [];
    let activeCategory = 'all';
    let activeSeries = 'all';
    let activeGenre = 'all';

    const seriesNames = {
      'genre-spotlight': 'Genre Spotlight',
      'behind-the-sample': 'Behind the Sample',
      'history-of': 'The History ofâ€¦'
    };

    function cap(s) { return s ? s.charAt(0).toUpperCase() + s.slice(1) : ''; }

    function fmtDate(d) {
      return new Date(d + 'T00:00:00').toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' });
    }

    function buildMeta(a) {
      let parts = ['<span class="sn-meta-cat">' + cap(a.category) + '</span>'];
      if (a.series && seriesNames[a.series]) {
        parts.push('<span class="sn-meta-dot"></span>');
        parts.push('<span class="sn-meta-series">' + seriesNames[a.series] + '</span>');
      }
      if (a.genre) {
        parts.push('<span class="sn-meta-dot"></span>');
        parts.push('<span class="sn-meta-genre">' + cap(a.genre) + '</span>');
      }
      parts.push('<span class="sn-meta-dot"></span>');
      parts.push('<span class="sn-meta-date">' + fmtDate(a.date) + '</span>');
      return parts.join('');
    }

    function buildCard(a, isFeatured) {
      const imgHtml = a.heroImage
        ? '<img src="' + a.heroImage.replace('front-1200', 'front-500') + '" alt="' + (a.heroAlt || a.title) + '" loading="lazy" decoding="async">'
        : '<div class="sn-placeholder">ðŸ“°</div>';

      return '<a href="/articles/' + a.slug + '" class="sn-card' + (isFeatured ? ' featured' : '') + '"'
        + ' data-category="' + (a.category || '') + '"'
        + (a.series ? ' data-series="' + a.series + '"' : '')
        + (a.genre ? ' data-genre="' + a.genre + '"' : '')
        + '>'
        + '<div class="sn-card-img">' + imgHtml + '</div>'
        + '<div class="sn-card-body">'
        + '<div class="sn-card-meta">' + buildMeta(a) + '</div>'
        + '<h3 class="sn-card-title">' + a.title + '</h3>'
        + '<p class="sn-card-desc">' + a.description + '</p>'
        + '</div></a>';
    }

    function buildGenrePills() {
      const genres = new Set();
      articles.forEach(a => { if (a.genre) genres.add(a.genre); });
      genrePillsWrap.innerHTML = '<button class="sn-genre-pill active" data-genre="all">All Genres</button>';
      genres.forEach(g => {
        genrePillsWrap.innerHTML += '<button class="sn-genre-pill" data-genre="' + g + '">' + cap(g) + '</button>';
      });
      genrePillsWrap.querySelectorAll('.sn-genre-pill').forEach(gp => {
        gp.addEventListener('click', () => {
          genrePillsWrap.querySelectorAll('.sn-genre-pill').forEach(g => g.classList.remove('active'));
          gp.classList.add('active');
          activeGenre = gp.dataset.genre;
          filterCards();
        });
      });
    }

    function filterCards() {
      let visibleCount = 0;
      cardEls.forEach(el => {
        const catMatch = activeCategory === 'all' || el.dataset.category === activeCategory;
        const seriesMatch = activeSeries === 'all' || el.dataset.series === activeSeries;
        const genreMatch = activeGenre === 'all' || el.dataset.genre === activeGenre;

        let show = catMatch;
        if (activeCategory === 'features') show = show && seriesMatch;
        if (activeSeries === 'genre-spotlight') show = show && genreMatch;

        el.style.display = show ? '' : 'none';
        if (show) visibleCount++;

        // Featured treatment: only first card in "all" view
        if (activeCategory === 'all' && activeSeries === 'all') {
          if (el === cardEls[0]) { el.classList.add('featured'); } else { el.classList.remove('featured'); }
        } else {
          el.classList.remove('featured');
        }
      });

      emptyEl.style.display = visibleCount === 0 ? 'block' : 'none';
      emptyEl.querySelector('p').textContent = 'No articles in this category yet â€” check back soon.';
    }

    // Pill listeners
    pillsWrap.querySelectorAll('.sn-pill').forEach(pill => {
      pill.addEventListener('click', () => {
        pillsWrap.querySelectorAll('.sn-pill').forEach(p => p.classList.remove('active'));
        pill.classList.add('active');
        activeCategory = pill.dataset.filter;

        if (activeCategory === 'features') {
          subPillsWrap.classList.add('visible');
        } else {
          subPillsWrap.classList.remove('visible');
          genrePillsWrap.classList.remove('visible');
          activeSeries = 'all';
          activeGenre = 'all';
          subPillsWrap.querySelectorAll('.sn-sub-pill').forEach(sp => sp.classList.toggle('active', sp.dataset.series === 'all'));
        }
        filterCards();
      });
    });

    subPillsWrap.querySelectorAll('.sn-sub-pill').forEach(sp => {
      sp.addEventListener('click', () => {
        subPillsWrap.querySelectorAll('.sn-sub-pill').forEach(s => s.classList.remove('active'));
        sp.classList.add('active');
        activeSeries = sp.dataset.series;

        if (activeSeries === 'genre-spotlight') {
          genrePillsWrap.classList.add('visible');
        } else {
          genrePillsWrap.classList.remove('visible');
          activeGenre = 'all';
          genrePillsWrap.querySelectorAll('.sn-genre-pill').forEach(g => g.classList.toggle('active', g.dataset.genre === 'all'));
        }
        filterCards();
      });
    });

    // Fetch and render
    fetch('/articles-index.json')
      .then(r => r.json())
      .then(data => {
        articles = data.sort((a, b) => new Date(b.date) - new Date(a.date));
        if (!articles.length) {
          emptyEl.querySelector('p').textContent = 'No articles yet. Check back soon.';
          return;
        }

        // Remove loading message
        emptyEl.style.display = 'none';

        // Build cards
        const html = articles.map((a, i) => buildCard(a, i === 0)).join('');
        grid.insertAdjacentHTML('afterbegin', html);
        cardEls = Array.from(grid.querySelectorAll('.sn-card'));

        // Build dynamic genre pills
        buildGenrePills();
      })
      .catch(err => {
        console.error('Failed to load articles:', err);
        emptyEl.querySelector('p').textContent = 'Failed to load articles. Please try again.';
      });
  })();

  // â”€â”€ Header autocomplete â”€â”€
  (function() {
    const input = document.getElementById('header-search-input');
    const dropdown = document.getElementById('header-autocomplete');
    const form = document.getElementById('header-search-form');
    let debounceTimer;

    if (!input || !dropdown || !form) return;

    form.addEventListener('submit', function(e) {
      e.preventDefault();
      const q = input.value.trim();
      if (q) window.location.href = '/results?q=' + encodeURIComponent(q);
    });

    input.addEventListener('input', function() {
      clearTimeout(debounceTimer);
      const q = input.value.trim();
      if (q.length < 2) { dropdown.style.display = 'none'; return; }
      debounceTimer = setTimeout(() => {
        fetch('/api/autocomplete?q=' + encodeURIComponent(q))
          .then(r => r.json())
          .then(data => {
            if (!data.artists?.length && !data.albums?.length) { dropdown.style.display = 'none'; return; }
            let html = '';
            if (data.artists?.length) {
              html += '<div style="padding:8px 16px;font-size:0.7rem;color:#9CA3AF;text-transform:uppercase;letter-spacing:0.05em;">Artists</div>';
              data.artists.forEach(a => {
                const meta = [a.type, a.country, a.disambiguation].filter(Boolean).join(' Â· ');
                html += '<a href="/results?q=' + encodeURIComponent(a.name) + '" style="display:block;padding:10px 16px;text-decoration:none;color:#1F2937;font-size:0.95rem;border-bottom:1px solid #F3F4F6;">' + a.name + (meta ? '<span style="color:#9CA3AF;font-size:0.8rem;margin-left:8px;">' + meta + '</span>' : '') + '</a>';
              });
            }
            if (data.albums?.length) {
              html += '<div style="padding:8px 16px;font-size:0.7rem;color:#9CA3AF;text-transform:uppercase;letter-spacing:0.05em;">Albums</div>';
              data.albums.forEach(a => {
                html += '<a href="/album?artist=' + encodeURIComponent(a.artist || '') + '&album=' + encodeURIComponent(a.name) + '" style="display:block;padding:10px 16px;text-decoration:none;color:#1F2937;font-size:0.95rem;border-bottom:1px solid #F3F4F6;">' + a.name + (a.artist ? '<span style="color:#9CA3AF;font-size:0.8rem;margin-left:8px;">' + a.artist + '</span>' : '') + '</a>';
              });
            }
            dropdown.innerHTML = html;
            dropdown.style.display = 'block';
          })
          .catch(() => { dropdown.style.display = 'none'; });
      }, 300);
    });

    document.addEventListener('click', function(e) {
      if (!dropdown.contains(e.target) && e.target !== input) dropdown.style.display = 'none';
    });
  })();
  </script>

</body>
</html>
